<!DOCTYPE html>
<html>
<head>
    <title>Sentiment Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .chart-container {
            height: 300px; /* Fixed height for consistent charts */
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h2 class="text-center">Sentiment Analysis Dashboard</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <!-- Pie Chart -->
                    <div class="col-md-6">
                        <div class="chart-container">
                            <canvas id="sentimentChart"></canvas>
                        </div>
                    </div>
                    <!-- Line Chart -->
                    <div class="col-md-6">
                        <div class="chart-container">
                            <canvas id="hourlyChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="mt-3 text-center">
                    <a href="/" class="btn btn-primary">Back to Analyzer</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Convert 24-hour to AM/PM format
        const formatHour = (hour) => {
            if (hour === 0) return '12 AM';
            if (hour < 12) return `${hour} AM`;
            if (hour === 12) return '12 PM';
            return `${hour - 12} PM`;
        };

        fetch('/get_sentiment_stats')
            .then(response => response.json())
            .then(data => {
                // 1. Pie Chart - Overall Sentiment
                new Chart(
                    document.getElementById('sentimentChart'),
                    {
                        type: 'doughnut',  // More modern than pie
                        data: {
                            labels: ['Positive', 'Neutral', 'Negative'],
                            datasets: [{
                                data: [
                                    data.overall.positive,
                                    data.overall.neutral,
                                    data.overall.negative
                                ],
                                backgroundColor: [
                                    '#4CAF50', // Green
                                    '#FFC107', // Yellow
                                    '#F44336'  // Red
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { 
                                    display: true, 
                                    text: 'Overall Sentiment',
                                    font: { size: 16 }
                                },
                                legend: { position: 'right' }
                            }
                        }
                    }
                );

                // 2. Line Chart - Hourly Trends
                const hours = data.hourly.map(item => formatHour(item._id));
                new Chart(
                    document.getElementById('hourlyChart'),
                    {
                        type: 'line',
                        data: {
                            labels: hours,
                            datasets: [
                                {
                                    label: 'Positive',
                                    data: data.hourly.map(item => item.positive),
                                    borderColor: '#4CAF50',
                                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                },
                                {
                                    label: 'Neutral',
                                    data: data.hourly.map(item=> item.neutral),
                                    borderColor: '#FFC107'
                                },
                                {
                                    label: 'Negative',
                                    data: data.hourly.map(item => item.negative),
                                    borderColor: '#F44336',
                                    backgroundColor: 'rgba(244, 67, 54, 0.1)',
                                    tension: 0.3,
                                    fill: true
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: { 
                                    display: true, 
                                    text: 'Hourly Trends',
                                    font: { size: 16 }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: (context) => 
                                            `${context.dataset.label}: ${context.raw} analyses`
                                    }
                                }
                            },
                            scales: {
                                y: { 
                                    beginAtZero: true,
                                    title: { display: true, text: 'Number of Analyses' }
                                },
                                x: {
                                    title: { display: true, text: 'Time of Day' }
                                }
                            }
                        }
                    }
                );
            });
    </script>
</body>
</html>